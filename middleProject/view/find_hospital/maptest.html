<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>대전 병원 지도</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Pretendard 폰트 -->
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <!-- 네이버 지도 API -->
  <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=oqxhiinnqp&submodules=geocoder"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
      background-color: #f4f7f9;
      color: #333;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 40px 20px;
      position: relative;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
    }

    header img {
      width: 140px;
      margin-bottom: 10px;
    }

    header h2 {
      font-size: 2rem;
      color: #2c3e50;
      margin: 0;
    }

    .category-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-bottom: 25px;
    }

    .category-buttons button {
      background-color: #ffffff;
      border: 2px solid #007bff;
      color: #007bff;
      padding: 12px 24px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
    }

    .category-buttons button.active,
    .category-buttons button:hover {
      background-color: #007bff;
      color: white;
      box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
    }

    #map {
      width: 100%;
      height: 600px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      border: 1px solid #e0e0e0;
    }

    .location-button {
      position: absolute;
      top: 105px;
      right: 20px;
      z-index: 1000;
      background-color: #28a745;
      color: white;
      padding: 12px 18px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    }

    .location-button:hover {
      background-color: #218838;
    }

    @media (max-width: 600px) {
      .category-buttons button {
        flex: 1 1 100%;
      }

      header h2 {
        font-size: 1.5rem;
      }

      .location-button {
        top: 160px;
        right: 10px;
        padding: 10px 14px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <header>
      <a href="../home/home.html">
      <img src="../../images/logo_img.png" alt="로고 이미지"> </a>
      <h2>대전 병원 지도</h2>
    </header>

    <!-- 카테고리 버튼 -->
    <div class="category-buttons">
      <button onclick="filterCategory('정형외과', this)">정형외과</button>
      <button onclick="filterCategory('내과', this)">내과</button>
      <button onclick="filterCategory('이비인후과', this)">이비인후과</button>
    </div>

    <!-- 내 위치 버튼 -->
    <button onclick="moveToMyLocation()" class="location-button">내 위치</button>

    <!-- 지도 -->
    <div id="map"></div>
  </div>

  <script>
    const map = new naver.maps.Map("map", {
      center: new naver.maps.LatLng(36.3504, 127.3845), // 대전 중심
      zoom: 14
    });

    let markers = [];

    const hospitalData = [
      { name: "튼튼 정형외과", category: "정형외과", lat: 36.3501, lng: 127.3850, info: "대전 중구 중앙로 123" },
      { name: "튼튼 내과", category: "내과", lat: 36.3522, lng: 127.3865, info: "대전 서구 둔산로 45" },
      { name: "귀코목 이비인후과", category: "이비인후과", lat: 36.3490, lng: 127.3820, info: "대전 유성구 문화로 67" }
    ];

    function filterCategory(category, button) {
      clearMarkers();
      setActiveButton(button);

      const filtered = hospitalData.filter(h => h.category === category);

      filtered.forEach(hospital => {
        const position = new naver.maps.LatLng(hospital.lat, hospital.lng);

        const marker = new naver.maps.Marker({
          position,
          map,
          icon: {
            content: `<div style="font-size:24px; transform: rotate(180deg); color:#ff4757;">⬇️</div>`,
            size: new naver.maps.Size(24, 24),
            anchor: new naver.maps.Point(12, 12)
          },
          title: hospital.name
        });

        const infoWindow = new naver.maps.InfoWindow({
          content: `<div style="padding:10px;">${hospital.name}</div>`
        });

        naver.maps.Event.addListener(marker, 'mouseover', () => infoWindow.open(map, marker));
        naver.maps.Event.addListener(marker, 'mouseout', () => infoWindow.close());
        naver.maps.Event.addListener(marker, 'click', () => {
          alert(`🏥 ${hospital.name}\n📍 ${hospital.info}`);
        });

        markers.push(marker);
      });
    }

    function clearMarkers() {
      markers.forEach(marker => marker.setMap(null));
      markers = [];
    }

    function setActiveButton(button) {
      document.querySelectorAll('.category-buttons button').forEach(btn => btn.classList.remove('active'));
      if (button) button.classList.add('active');
    }

function moveToMyLocation() {
  // 브라우저가 Geolocation API를 지원하는지 확인합니다.
  if (navigator.geolocation) {
    // 사용자의 현재 위치를 가져옵니다.
    navigator.geolocation.getCurrentPosition(function(position) {
      // 위치 객체에서 위도와 경도를 추출합니다.
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;

      // 사용자의 현재 좌표로 Naver Maps LatLng 객체를 생성합니다.
      const myLocation = new naver.maps.LatLng(lat, lng);

      // 지도의 중심을 사용자의 현재 위치로 설정합니다.
      map.setCenter(myLocation);
      // 지도의 확대/축소 레벨을 설정합니다.
      map.setZoom(15);

      // 사용자의 위치를 표시하기 위한 새로운 Naver Maps 마커를 생성합니다.
      new naver.maps.Marker({
        position: myLocation, // 마커의 위치를 사용자 위치로 설정합니다.
        map: map, // 마커를 지도 인스턴스와 연결합니다.
        icon: {
          // HTML을 사용하여 마커의 사용자 지정 아이콘을 정의합니다 (이모지).
          content: `<div style="font-size:24px; color:#28a745;">🧍</div>`,
          size: new naver.maps.Size(24, 24), // 사용자 지정 아이콘의 크기를 설정합니다.
          anchor: new naver.maps.Point(12, 12) // 아이콘의 앵커 포인트(중심)를 설정합니다.
        },
        title: "내 위치" // 마커의 제목(툴팁)을 설정합니다.
      });
    }, function() {
      // 위치 정보를 가져오는 데 오류가 발생하면 이 함수가 호출됩니다.
      // 사용자에게 위치 정보를 가져오지 못했음을 알립니다.
      alert("위치 정보를 가져오지 못했습니다. 위치 접근을 허용해주세요.");
    });
  } else {
    // 브라우저가 Geolocation을 지원하지 않는 경우 이 블록이 실행됩니다.
    // 사용자에게 Geolocation이 지원되지 않음을 알립니다.
    alert("이 브라우저에서는 위치 정보 사용이 지원되지 않습니다.");
  }
}

    // 초기 로딩 시 전체 병원 목록 보여주지 않고 대전만 표시
    window.onload = function () {
      setActiveButton(null);
    };
  </script>

</body>
</html>
