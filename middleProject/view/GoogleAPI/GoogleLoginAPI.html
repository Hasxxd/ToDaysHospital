<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Google Login with reCAPTCHA</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <script>
    let jwtToken = null;

    function handleCredentialResponse(response) {
      jwtToken = response.credential;
      document.getElementById("recaptcha-container").style.display = "block";
    }

    function verifyAndSubmit() {
      const recaptchaResponse = grecaptcha.getResponse();
      if (!recaptchaResponse) {
        alert("reCAPTCHA 인증을 완료해주세요.");
        return;
      }

      if (!jwtToken) {
        alert("먼저 Google 로그인을 완료해주세요.");
        return;
      }

      console.log("JWT: " + jwtToken);
      window.opener.location.href = 'https://hosday.kro.kr/middleProject/view/home/home.html';
      window.close();
    }
  </script>
</head>
<body>
  <!-- Google Login -->
  <div id="g_id_onload"
       data-client_id="2985652347491-qsj5dott56kpcushrfqc6ru3r60dmdnn.apps.googleusercontent.com"
       data-callback="handleCredentialResponse">
  </div>
  <div class="g_id_signin"></div>

  <!-- reCAPTCHA: initially hidden -->
  <div id="recaptcha-container" style="display:none; margin-top: 20px;">
    <form onsubmit="verifyAndSubmit(); return false;">
      <div class="g-recaptcha"
           data-sitekey="6LcWLIUrAAAAAPs1Nj_0_lYhJ3sE_tfDvzVTUnAE"></div>
      <br/>
      <button type="submit">확인</button>
    </form>
  </div>
</body>
</html>

